flowchart LR
  %% ========= GLOBAL =========
  U[Users/Clients] --> R53[Route 53 Failover DNS]

  %% ========= REGION A =========
  subgraph RA[Region A - ACTIVE]
    APIGA[API Gateway Regional]
    R53 -->|Primary| APIGA

    subgraph VPC_A[VPC-A 10.0.0.0/16]
      subgraph PUB_A[Public Subnets AZ-a, AZ-b]
        NATa[NAT GW-a]
        NATb[NAT GW-b]
      end

      subgraph PRIV_A[Private App Subnets AZ-a, AZ-b]
        LQ[Lambda - Query Orchestrator]
        LI[Lambda - Ingestion/Chunking]
      end

      VPCE_AOSS[VPCe: OpenSearch Serverless]
      VPCE_S3[S3 Gateway Endpoint]
      VPCE_MISC[VPCe: Logs/Secrets/KMS/STS]
    end

    S3A[S3 Bucket docs/chunks]
    AOSS_A[OpenSearch Serverless\nVector Collection]
    BRRT_A[Bedrock Runtime\nEmbeddings]
    LLM_A[Bedrock LLM\nGeneration]

    APIGA --> LQ
    S3A --> LI
    LI --> BRRT_A
    LI --> AOSS_A
    LQ --> AOSS_A
    LQ --> LLM_A

    %% endpoint intent
    LI -.via VPCe/NAT.-> BRRT_A
    LQ -.via VPCe/NAT.-> LLM_A
    LQ -.via VPCe.-> VPCE_AOSS
    LI -.via VPCE.-> VPCE_S3
  end

  %% ========= REGION B =========
  subgraph RB[Region B - HOT STANDBY no traffic]
    APIGB[API Gateway Regional]
    R53 -->|Secondary Failover only| APIGB

    subgraph VPC_B[VPC-B 10.1.0.0/16]
      subgraph PUB_B[Public Subnets AZ-a, AZ-b]
        NATa2[NAT GW-a]
        NATb2[NAT GW-b]
      end
      subgraph PRIV_B[Private App Subnets AZ-a, AZ-b]
        LQ2[Lambda - Query Orchestrator]
        LI2[Lambda - Ingestion/Chunking]
      end
      VPCE2_AOSS[VPCe: OpenSearch Serverless]
      VPCE2_S3[S3 Gateway Endpoint]
    end

    S3B[S3 Bucket Replica]
    AOSS_B[OpenSearch Serverless\nVector Collection Replica]
    BRRT_B[Bedrock Runtime\nEmbeddings]
    LLM_B[Bedrock LLM\nGeneration]

    APIGB --> LQ2
    S3B --> LI2
    LI2 --> BRRT_B
    LI2 --> AOSS_B
    LQ2 --> AOSS_B
    LQ2 --> LLM_B
  end

  %% ========= REPLICATION =========
  S3A == CRR ==> S3B
  LI == dual-write option ==> AOSS_B
